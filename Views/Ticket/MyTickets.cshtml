@model IEnumerable<Ticket>
@{
    ViewData["Title"] = "My Tickets";
}

<!DOCTYPE html>
<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>My Tickets - Enterprise IT Support Suite</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#1392ec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101a22",
                        "card-dark": "#1e293b",
                        "status-open": "#3b82f6",
                        "status-progress": "#f59e0b",
                        "status-resolved": "#10b981",
                    },
                    fontFamily: {
                        "display": ["Manrope"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
<style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        body {
            font-family: 'Manrope', sans-serif;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }
        .truncate-2-lines {
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 min-h-screen">
<div class="flex h-screen overflow-hidden">
<aside class="w-72 flex-shrink-0 bg-[#0b1217] border-r border-slate-800 flex flex-col h-full">
<div class="p-6 flex items-center justify-between border-b border-slate-800">
<div class="flex items-center gap-3">
<div class="size-10 bg-primary rounded-lg flex items-center justify-center text-white">
<span class="material-symbols-outlined text-2xl">confirmation_number</span>
</div>
<div>
<h1 class="text-sm font-bold leading-tight">Enterprise IT</h1>
<p class="text-[11px] text-slate-400 uppercase tracking-widest font-semibold">Support Suite</p>
</div>
</div>
<button class="text-slate-400 hover:text-white transition-colors">
<span class="material-symbols-outlined">menu_open</span>
</button>
</div>
<nav class="flex-1 overflow-y-auto py-6 px-4 space-y-8 custom-scrollbar">
<div class="space-y-1">
<p class="px-3 text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Main</p>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all" href="@Url.Action("Dashboard", "Home")">
<span class="material-symbols-outlined text-[22px]">dashboard</span>
<span class="text-sm font-medium">Dashboard</span>
</a>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all" href="@Url.Action("Create", "Ticket")">
<span class="material-symbols-outlined text-[22px]">add_box</span>
<span class="text-sm font-medium">Create Ticket</span>
</a>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-primary/10 text-primary border border-primary/20" href="@Url.Action("MyTickets", "Ticket")">
<span class="material-symbols-outlined text-[22px]">label_important</span>
<span class="text-sm font-semibold">My Tickets</span>
</a>
</div>
<div class="space-y-1">
<p class="px-3 text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">IT Operations</p>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all" href="@Url.Action("AssignedTickets", "Ticket")">
<span class="material-symbols-outlined text-[22px]">assignment_turned_in</span>
<span class="text-sm font-medium">Assigned Tickets</span>
</a>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all" href="#">
<span class="material-symbols-outlined text-[22px]">auto_stories</span>
<span class="text-sm font-medium">Knowledge Base</span>
</a>
</div>
</nav>
<div class="p-4 border-t border-slate-800 space-y-4">
<div class="flex items-center gap-3 px-2 py-3 rounded-xl bg-slate-900/50">
<div class="size-10 rounded-full bg-cover bg-center" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuArhuNpL6O2HO3VaecONI9ePl8kTsrXfeTFI5LK7BzENiLP-8MRM6RBuVTDIjQMSQfhpE8tBT_LEQLts5hq7bbIl70G3Cn252z3Wnc9-tJDv82BhN9lMhi2XXG1KZBLvk6yfQlKqy6snvgzooimixBWl2G8IrX_8JGKn7z5cetYKnh-EVvTcbY3t5MUbyRglLNYoPZ86kfrcumsVneTPH4HLO47tpNHhav1ks5bHqx9iVh8NfBJNRTGCGkfYSZsoZHVZ5xcU2Dr1AVd')"></div>
<div class="flex-1 overflow-hidden">
<p class="text-sm font-bold truncate">@User.Identity?.Name</p>
<p class="text-[11px] text-slate-400">@User.FindFirst("Role")?.Value</p>
</div>
<button class="text-slate-500 hover:text-white transition-colors">
<span class="material-symbols-outlined text-sm">logout</span>
</button>
</div>
</div>
</aside>
<main class="flex-1 flex flex-col bg-background-light dark:bg-background-dark overflow-hidden">
<header class="h-16 border-b border-slate-200 dark:border-slate-800 px-8 flex items-center justify-between bg-white dark:bg-[#101a22] z-10">
<div class="flex items-center gap-6">
<h2 class="text-lg font-bold tracking-tight">My Ticket History</h2>
<div class="h-6 w-px bg-slate-200 dark:bg-slate-800"></div>
<div class="flex items-center gap-2 text-xs font-semibold text-slate-500">
<span>Support</span>
<span class="material-symbols-outlined text-[14px]">chevron_right</span>
<span class="text-primary">My Tickets</span>
</div>
</div>
<div class="flex items-center gap-4">
<button class="px-4 py-2 bg-primary text-white text-xs font-bold rounded-lg hover:bg-primary/90 transition-all flex items-center gap-2" onclick="location.href='@Url.Action("Create", "Ticket")'">
<span class="material-symbols-outlined text-[18px]">add</span>
                    New Ticket
                </button>
<div class="h-6 w-px bg-slate-200 dark:bg-slate-800 mx-2"></div>
<button class="relative size-10 flex items-center justify-center bg-slate-100 dark:bg-slate-800 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
<span class="material-symbols-outlined text-slate-600 dark:text-slate-300">notifications</span>
<span class="absolute top-2.5 right-2.5 size-2 bg-red-500 rounded-full border-2 border-white dark:border-[#101a22]"></span>
</button>
</div>
</header>
<div class="flex-1 overflow-y-auto p-8 custom-scrollbar">
<div class="max-w-[1400px] mx-auto space-y-6">
<div class="flex flex-col md:flex-row gap-4 items-center justify-between">
<form method="get" action="@Url.Action("MyTickets", "Ticket")" class="flex flex-col md:flex-row gap-4 items-center w-full" id="searchForm">
<div class="relative w-full md:w-96">
<span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-[20px]" id="searchIcon">search</span>
<input name="search" value="@ViewBag.Search" id="searchInput" class="w-full bg-white dark:bg-[#1e293b] border-slate-200 dark:border-slate-800 rounded-lg pl-10 pr-10 py-2 text-sm focus:ring-primary focus:border-primary transition-all" placeholder="Search by Ticket ID, title..." type="text"/>
<div id="searchSpinner" class="absolute right-3 top-1/2 -translate-y-1/2 hidden">
    <div class="animate-spin rounded-full h-4 w-4 border-2 border-slate-300 border-t-primary"></div>
</div>
@if (!string.IsNullOrEmpty(ViewBag.Search))
{
    <button type="button" onclick="clearSearch()" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors" id="clearButton">
        <span class="material-symbols-outlined text-[18px]">close</span>
    </button>
}
</div>
<div class="flex items-center gap-2 w-full md:w-auto">
<select name="status" class="bg-white dark:bg-[#1e293b] border-slate-200 dark:border-slate-800 rounded-lg px-4 py-2 text-xs font-semibold focus:ring-primary focus:border-primary transition-all" id="statusSelect">
<option value="All" selected="@(ViewBag.Status == "All")">All Status</option>
<option value="Open" selected="@(ViewBag.Status == "Open")">Open</option>
<option value="In-Progress" selected="@(ViewBag.Status == "In-Progress")">In-Progress</option>
<option value="Resolved" selected="@(ViewBag.Status == "Resolved")">Resolved</option>
<option value="Closed" selected="@(ViewBag.Status == "Closed")">Closed</option>
</select>
<select name="category" class="bg-white dark:bg-[#1e293b] border-slate-200 dark:border-slate-800 rounded-lg px-4 py-2 text-xs font-semibold focus:ring-primary focus:border-primary transition-all" id="categorySelect">
<option value="All" selected="@(ViewBag.Category == "All")">All Problem Types</option>
<option value="Software Issue" selected="@(ViewBag.Category == "Software Issue")">Software</option>
<option value="Hardware Failure" selected="@(ViewBag.Category == "Hardware Failure")">Hardware</option>
<option value="Network/Access Issue" selected="@(ViewBag.Category == "Network/Access Issue")">Access</option>
<option value="Email & Communication" selected="@(ViewBag.Category == "Email & Communication")">Network</option>
</select>
<button type="submit" class="p-2 bg-white dark:bg-[#1e293b] border border-slate-200 dark:border-slate-800 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
<span class="material-symbols-outlined text-[20px] text-slate-500">filter_list</span>
</button>
<button type="button" onclick="clearAllFilters()" class="px-3 py-2 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2">
<span class="material-symbols-outlined text-[18px] text-slate-600 dark:text-slate-400">refresh</span>
<span class="text-xs font-semibold text-slate-600 dark:text-slate-400">Clear</span>
</button>
</div>
</form>
</div>
<div class="bg-white dark:bg-[#1e293b] rounded-xl border border-slate-200 dark:border-slate-800 shadow-xl overflow-hidden relative">
<div id="tableLoadingOverlay" class="absolute inset-0 bg-white/80 dark:bg-[#1e293b]/80 backdrop-blur-sm z-10 hidden">
    <div class="flex items-center justify-center h-32">
        <div class="flex flex-col items-center gap-3">
            <div class="animate-spin rounded-full h-8 w-8 border-2 border-slate-300 border-t-primary"></div>
            <span class="text-sm text-slate-600 dark:text-slate-400">Searching...</span>
        </div>
    </div>
</div>
<div class="overflow-x-auto" id="ticketTableContainer">
<table class="w-full text-left border-collapse">
<thead>
<tr class="bg-slate-50/50 dark:bg-slate-900/40 border-b border-slate-100 dark:border-slate-800">
<th class="px-6 py-4 text-[11px] font-bold text-slate-500 uppercase tracking-wider w-32">Ticket ID</th>
<th class="px-6 py-4 text-[11px] font-bold text-slate-500 uppercase tracking-wider w-40">Problem Type</th>
<th class="px-6 py-4 text-[11px] font-bold text-slate-500 uppercase tracking-wider">Description</th>
<th class="px-6 py-4 text-[11px] font-bold text-slate-500 uppercase tracking-wider w-32">Location</th>
<th class="px-6 py-4 text-[11px] font-bold text-slate-500 uppercase tracking-wider w-40">Status</th>
<th class="px-6 py-4 text-[11px] font-bold text-slate-500 uppercase tracking-wider w-44">Date Submitted</th>
<th class="px-6 py-4 text-[11px] font-bold text-slate-500 uppercase tracking-wider w-24">Actions</th>
</tr>
</thead>
<tbody class="divide-y divide-slate-100 dark:divide-slate-800">
@if (Model != null && Model.Any())
{
    @foreach (var ticket in Model)
    {
        <tr class="group hover:bg-slate-50/50 dark:hover:bg-slate-900/20 transition-colors">
            <td class="px-6 py-4">
                <span class="text-sm font-bold text-primary">#TIC-@ticket.Id.ToString("D4")</span>
            </td>
            <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-[18px] text-slate-400">
                        @(ticket.Category.ToLower() switch {
                            "software issue" => "system_update",
                            "hardware failure" => "devices",
                            "network/access issue" => "wifi",
                            "email & communication" => "mail",
                            "asset request" => "inventory",
                            _ => "help"
                        })
                    </span>
                    <span class="text-sm font-medium">@ticket.Category</span>
                </div>
            </td>
            <td class="px-6 py-4">
                <div class="max-w-md">
                    <p class="text-sm text-slate-600 dark:text-slate-300 truncate-2-lines">@ticket.Description</p>
                </div>
            </td>
            <td class="px-6 py-4">
                <div class="flex items-center gap-2 text-slate-500" title="Work Location">
                    <span class="material-symbols-outlined text-[18px]">
                        @(ticket.WorkLocation?.Contains("Work From Home") == true || ticket.WorkLocation?.Contains("WFH") == true ? "home_work" : "apartment")
                    </span>
                    <span class="text-xs">@(ticket.WorkLocation?.Contains("Work From Home") == true || ticket.WorkLocation?.Contains("WFH") == true ? "WFH" : "Office")</span>
                </div>
            </td>
            <td class="px-6 py-4">
                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-[10px] font-bold @(ticket.Status.ToLower() switch {
                    "open" => "bg-blue-100 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-500/20",
                    "in-progress" => "bg-amber-100 dark:bg-amber-500/10 text-amber-600 dark:text-amber-400 border border-amber-200 dark:border-amber-500/20",
                    "resolved" => "bg-emerald-100 dark:bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border border-emerald-200 dark:border-emerald-500/20",
                    "closed" => "bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700",
                    _ => "bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700"
                }) uppercase tracking-wider">
                    @ticket.Status
                </span>
            </td>
            <td class="px-6 py-4">
                <div class="text-xs text-slate-500 group-hover:text-slate-300 transition-colors">
                    @ticket.CreatedAt.ToString("MMM dd, yyyy • hh:mm tt")
                </div>
            </td>
            <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                    <button class="p-1.5 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-800 text-slate-400 hover:text-primary transition-all relative group/btn" onclick="showTicketDetails(@ticket.Id, '@(ticket.TeamViewerId?.Replace("'", "\\'") ?? "")', '@(ticket.TeamViewerPassword?.Replace("'", "\\'") ?? "")', '@(ticket.ContactEmail?.Replace("'", "\\'") ?? "")', '@(ticket.ContactNumber?.Replace("'", "\\'") ?? "")')">
                        <span class="material-symbols-outlined text-[20px]">visibility</span>
                        <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover/btn:block bg-slate-900 text-white text-[10px] py-1 px-2 rounded whitespace-nowrap z-20">
                            View Details
                        </div>
                    </button>
                    <button class="p-1.5 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-800 text-slate-400 hover:text-white transition-all">
                        <span class="material-symbols-outlined text-[20px]">more_vert</span>
                    </button>
                </div>
            </td>
        </tr>
    }
}
else
{
    <tr>
        <td colspan="7" class="px-6 py-12 text-center">
            <div class="flex flex-col items-center gap-4">
                <span class="material-symbols-outlined text-4xl text-slate-300">inbox</span>
                <p class="text-sm text-slate-500">No tickets found. Create your first ticket to get started!</p>
                <button class="px-4 py-2 bg-primary text-white text-xs font-bold rounded-lg hover:bg-primary/90 transition-all flex items-center gap-2" onclick="location.href='@Url.Action("Create", "Ticket")'">
                    <span class="material-symbols-outlined text-[18px]">add</span>
                    Create Ticket
                </button>
            </div>
        </td>
    </tr>
}
</tbody>
</table>
</div>
<div class="p-4 border-t border-slate-100 dark:border-slate-800 bg-slate-50/30 dark:bg-slate-900/40 flex items-center justify-between">
<p class="text-xs text-slate-500 font-medium">
    Showing 
    <span class="text-slate-900 dark:text-white">
        @(((ViewBag.CurrentPage - 1) * ViewBag.PageSize) + 1)
    </span> 
    to 
    <span class="text-slate-900 dark:text-white">
        @Math.Min(ViewBag.CurrentPage * ViewBag.PageSize, ViewBag.TotalCount)
    </span> 
    of 
    <span class="text-slate-900 dark:text-white">@ViewBag.TotalCount</span> 
    tickets
</p>
<div class="flex items-center gap-1">
    @if (ViewBag.HasPreviousPage)
    {
        <a href="@Url.Action("MyTickets", new { page = ViewBag.CurrentPage - 1, search = ViewBag.Search, status = ViewBag.Status, category = ViewBag.Category })" 
           class="size-8 flex items-center justify-center rounded border border-slate-200 dark:border-slate-800 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
            <span class="material-symbols-outlined text-[18px]">chevron_left</span>
        </a>
    }
    else
    {
        <button class="size-8 flex items-center justify-center rounded border border-slate-200 dark:border-slate-800 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800 disabled:opacity-50 transition-colors" disabled>
            <span class="material-symbols-outlined text-[18px]">chevron_left</span>
        </button>
    }
    
    @for (int i = 1; i <= ViewBag.TotalPages; i++)
    {
        if (i == ViewBag.CurrentPage)
        {
            <button class="size-8 flex items-center justify-center rounded bg-primary text-white text-xs font-bold">@i</button>
        }
        else
        {
            <a href="@Url.Action("MyTickets", new { page = i, search = ViewBag.Search, status = ViewBag.Status, category = ViewBag.Category })" 
               class="size-8 flex items-center justify-center rounded border border-slate-200 dark:border-slate-800 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800 text-xs font-bold transition-colors">
                @i
            </a>
        }
    }
    
    @if (ViewBag.HasNextPage)
    {
        <a href="@Url.Action("MyTickets", new { page = ViewBag.CurrentPage + 1, search = ViewBag.Search, status = ViewBag.Status, category = ViewBag.Category })" 
           class="size-8 flex items-center justify-center rounded border border-slate-200 dark:border-slate-800 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
            <span class="material-symbols-outlined text-[18px]">chevron_right</span>
        </a>
    }
    else
    {
        <button class="size-8 flex items-center justify-center rounded border border-slate-200 dark:border-slate-800 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" disabled>
            <span class="material-symbols-outlined text-[18px]">chevron_right</span>
        </button>
    }
</div>
</div>
</div>
<p class="text-center text-xs text-slate-500">
                    Showing your ticket history from the last 90 days. For older tickets, please contact the <span class="text-primary font-bold">Archive Department</span>.
                </p>
</div>
</div>
</main>
</div>

<!-- Ticket Details Modal -->
<div id="ticketModal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 hidden">
<div class="absolute inset-0 bg-slate-950/80 backdrop-blur-sm"></div>
<div class="relative w-full max-w-2xl bg-[#1e293b] rounded-2xl border border-slate-700 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
<div class="p-6 border-b border-slate-700 flex items-center justify-between bg-slate-900/50">
<div class="flex items-center gap-4">
<div class="size-12 bg-primary/20 rounded-xl flex items-center justify-center text-primary">
<span class="material-symbols-outlined text-3xl">confirmation_number</span>
</div>
<div>
<div class="flex items-center gap-3">
<h3 id="modalTicketId" class="text-xl font-bold text-white tracking-tight">#TIC-0000</h3>
<span id="modalTicketStatus" class="inline-flex items-center px-2.5 py-1 rounded-full text-[10px] font-bold bg-blue-500/10 text-blue-400 border border-blue-500/20 uppercase tracking-wider">
Open
</span>
</div>
<p id="modalTicketMeta" class="text-xs text-slate-400 mt-1 font-medium">Problem Type • Submitted Date</p>
</div>
</div>
<button onclick="closeTicketModal()" class="size-10 rounded-full hover:bg-slate-800 flex items-center justify-center text-slate-400 hover:text-white transition-colors">
<span class="material-symbols-outlined">close</span>
</button>
</div>
<div class="flex-1 overflow-y-auto p-6 custom-scrollbar space-y-8">
<section>
<h4 class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2">
<span class="material-symbols-outlined text-[16px]">person</span>
User Information
</h4>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div class="bg-slate-900/40 p-3 rounded-lg border border-slate-800">
<p class="text-[10px] text-slate-500 uppercase font-bold mb-1">Email Address</p>
<p id="modalUserEmail" class="text-sm font-medium text-slate-200 break-words">user@company.com</p>
</div>
<div class="bg-slate-900/40 p-3 rounded-lg border border-slate-800">
<p class="text-[10px] text-slate-500 uppercase font-bold mb-1">Contact Number</p>
<p id="modalUserPhone" class="text-sm font-medium text-slate-200">+1 (555) 000-0000</p>
</div>
<div class="bg-slate-900/40 p-3 rounded-lg border border-slate-800">
<p class="text-[10px] text-slate-500 uppercase font-bold mb-1">Location</p>
<div class="flex items-center gap-1.5">
<span id="modalLocationIcon" class="material-symbols-outlined text-[16px] text-slate-400">apartment</span>
<p id="modalUserLocation" class="text-sm font-medium text-slate-200">Office</p>
</div>
</div>
</div>
</section>
<section>
<h4 class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2">
<span class="material-symbols-outlined text-[16px]">settings_remote</span>
Remote Access Details
</h4>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="flex items-center justify-between p-3 rounded-lg border border-slate-800 bg-slate-900/40">
<div>
<p class="text-[10px] text-slate-500 uppercase font-bold mb-1">Team Viewer ID</p>
<p id="modalTeamViewerId" class="text-sm font-mono text-primary font-bold tracking-wider">N/A</p>
</div>
<button class="text-slate-500 hover:text-primary transition-colors" onclick="copyToClipboard('modalTeamViewerId')">
<span class="material-symbols-outlined text-[20px]">content_copy</span>
</button>
</div>
<div class="flex items-center justify-between p-3 rounded-lg border border-slate-800 bg-slate-900/40">
<div>
<p class="text-[10px] text-slate-500 uppercase font-bold mb-1">Password</p>
<div class="flex items-center gap-2">
<p id="modalTeamViewerPassword" class="text-sm font-mono text-slate-200 font-bold tracking-widest">••••••••</p>
</div>
</div>
<button class="text-slate-500 hover:text-primary transition-colors" onclick="togglePasswordVisibility()">
<span id="passwordToggleIcon" class="material-symbols-outlined text-[20px]">visibility</span>
</button>
</div>
</div>
</section>
<section>
<h4 class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2">
<span class="material-symbols-outlined text-[16px]">description</span>
Problem Description
</h4>
<div class="bg-slate-900/40 p-5 rounded-lg border border-slate-800">
<h5 id="modalTicketSubject" class="text-sm font-bold text-white mb-2">Ticket Subject</h5>
</div>
</section>
</div>
<div class="p-6 border-t border-slate-700 bg-slate-900/50 flex items-center justify-between">
<button onclick="closeTicketModal()" class="px-5 py-2.5 text-xs font-bold text-slate-400 hover:text-white transition-colors flex items-center gap-2 border border-slate-700 rounded-lg hover:bg-slate-800">
<span class="material-symbols-outlined text-[18px]">close</span>
Close
</button>
<div class="flex items-center gap-3">
<button class="px-5 py-2.5 text-xs font-bold text-slate-300 bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded-lg transition-all flex items-center gap-2">
<span class="material-symbols-outlined text-[18px]">add_comment</span>
Add Comment
</button>
<button class="px-5 py-2.5 text-xs font-bold text-white bg-primary hover:bg-primary/90 rounded-lg transition-all flex items-center gap-2 shadow-lg shadow-primary/20">
<span class="material-symbols-outlined text-[18px]">edit_note</span>
Update Ticket
</button>
</div>
</div>
</div>
</div>

<!-- Success Toast Notification -->
@if (TempData["SuccessMessage"] != null)
{
    <div id="successToast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg flex items-center gap-3 z-50 transform transition-transform duration-300 translate-x-full">
        <span class="material-symbols-outlined text-white">check_circle</span>
        <span class="font-medium">@TempData["SuccessMessage"]</span>
    </div>
}

<script>
    // Show success toast if it exists
    document.addEventListener('DOMContentLoaded', function() {
        const toast = document.getElementById('successToast');
        if (toast) {
            // Slide in the toast
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
                toast.classList.add('translate-x-0');
            }, 100);
            
            // Hide the toast after 5 seconds
            setTimeout(() => {
                toast.classList.remove('translate-x-0');
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 5000);
        }
        
        // Enhanced smooth search functionality
        const searchInput = document.getElementById('searchInput');
        const searchSpinner = document.getElementById('searchSpinner');
        const searchIcon = document.getElementById('searchIcon');
        const clearButton = document.getElementById('clearButton');
        const tableOverlay = document.getElementById('tableLoadingOverlay');
        const statusSelect = document.getElementById('statusSelect');
        const categorySelect = document.getElementById('categorySelect');
        let searchTimeout;
        
        function showLoading() {
            searchSpinner.classList.remove('hidden');
            searchIcon.classList.add('hidden');
            if (clearButton) clearButton.classList.add('hidden');
            tableOverlay.classList.remove('hidden');
        }
        
        function hideLoading() {
            searchSpinner.classList.add('hidden');
            searchIcon.classList.remove('hidden');
            tableOverlay.classList.add('hidden');
        }
        
        function performSearch() {
            const form = document.getElementById('searchForm');
            if (form) {
                showLoading();
                // Add a small delay to show loading state
                setTimeout(() => {
                    form.submit();
                }, 300);
            }
        }
        
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const hasValue = this.value.trim().length > 0;
                
                // Show/hide clear button dynamically
                if (clearButton) {
                    clearButton.style.display = hasValue ? 'block' : 'none';
                }
                
                // Debounced search with shorter delay for better UX
                searchTimeout = setTimeout(() => {
                    performSearch();
                }, 300); // Reduced from 500ms to 300ms for faster response
            });
            
            // Add keyup event for immediate feedback on Enter
            searchInput.addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    clearTimeout(searchTimeout);
                    performSearch();
                }
            });
        }
        
        // Add change listeners for dropdowns with smooth transitions
        if (statusSelect) {
            statusSelect.addEventListener('change', function() {
                showLoading();
                setTimeout(() => {
                    document.getElementById('searchForm').submit();
                }, 200);
            });
        }
        
        if (categorySelect) {
            categorySelect.addEventListener('change', function() {
                showLoading();
                setTimeout(() => {
                    document.getElementById('searchForm').submit();
                }, 200);
            });
        }
    });
    
    // Modal functions
    function showTicketDetails(ticketId, teamViewerId, teamViewerPassword, contactEmail, contactNumber) {
        // Find the ticket data from the table row
        const ticketRow = document.querySelector(`button[onclick*="showTicketDetails(${ticketId}"]`).closest('tr');
        const cells = ticketRow.getElementsByTagName('td');
        
        // Extract ticket data from the table
        const ticketIdText = cells[0].textContent.trim();
        const category = cells[1].textContent.trim();
        const description = cells[2].textContent.trim();
        const location = cells[3].textContent.trim();
        const status = cells[4].textContent.trim();
        const date = cells[5].textContent.trim();
        
        // Update modal content
        const now = new Date();
        const timestamp = now.getFullYear().toString() + (now.getMonth() + 1).toString().padStart(2, '0') + now.getDate().toString().padStart(2, '0') + now.getHours().toString().padStart(2, '0') + now.getMinutes().toString().padStart(2, '0');
        document.getElementById('modalTicketId').textContent = `#TIC-${timestamp}`;
        document.getElementById('modalTicketStatus').textContent = status;
        document.getElementById('modalTicketMeta').textContent = `${category} • ${date}`;
        
        // Extract subject from description (first sentence or first 50 chars)
        const subjectText = description.split('.')[0].trim() || description.substring(0, 50).trim();
        document.getElementById('modalTicketSubject').textContent = subjectText;
        
        // Update status styling
        const statusElement = document.getElementById('modalTicketStatus');
        statusElement.className = 'inline-flex items-center px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider border';
        
        if (status.includes('Open')) {
            statusElement.className += ' bg-blue-500/10 text-blue-400 border-blue-500/20';
        } else if (status.includes('In-Progress')) {
            statusElement.className += ' bg-amber-500/10 text-amber-400 border-amber-500/20';
        } else if (status.includes('Resolved')) {
            statusElement.className += ' bg-emerald-500/10 text-emerald-400 border-emerald-500/20';
        } else if (status.includes('Closed')) {
            statusElement.className += ' bg-slate-500/10 text-slate-400 border-slate-500/20';
        }
        
        // Update location
        const locationIcon = document.getElementById('modalLocationIcon');
        const locationText = document.getElementById('modalUserLocation');
        if (location.includes('WFH')) {
            locationIcon.textContent = 'home_work';
            locationText.textContent = 'Work From Home';
        } else {
            locationIcon.textContent = 'apartment';
            locationText.textContent = 'Office';
        }
        
        // Update user information with actual data
        document.getElementById('modalUserEmail').textContent = contactEmail || 'user@company.com';
        document.getElementById('modalUserPhone').textContent = contactNumber || '+1 (555) 000-0000';
        
        // Update TeamViewer details with actual data
        document.getElementById('modalTeamViewerId').textContent = teamViewerId || 'N/A';
        document.getElementById('modalTeamViewerPassword').textContent = teamViewerPassword ? '••••••••' : '••••••••';
        
        // Store actual password for toggle functionality
        if (teamViewerPassword) {
            document.getElementById('modalTeamViewerPassword').setAttribute('data-password', teamViewerPassword);
        }
        
        // Show modal
        document.getElementById('ticketModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    
    function closeTicketModal() {
        document.getElementById('ticketModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }
    
    function copyToClipboard(elementId) {
        const text = document.getElementById(elementId).textContent;
        if (text && text !== 'N/A') {
            navigator.clipboard.writeText(text).then(() => {
                // Show brief feedback
                const button = event.target.closest('button');
                const originalHTML = button.innerHTML;
                button.innerHTML = '<span class="material-symbols-outlined text-[20px] text-green-400">check</span>';
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                }, 1000);
            });
        }
    }
    
    function togglePasswordVisibility() {
        const passwordElement = document.getElementById('modalTeamViewerPassword');
        const toggleIcon = document.getElementById('passwordToggleIcon');
        
        if (passwordElement.textContent.includes('•')) {
            // Show actual password
            const actualPassword = passwordElement.getAttribute('data-password');
            if (actualPassword) {
                passwordElement.textContent = actualPassword;
                toggleIcon.textContent = 'visibility_off';
            }
        } else {
            // Hide password
            passwordElement.textContent = '••••••••';
            toggleIcon.textContent = 'visibility';
        }
    }
    
    function clearAllFilters() {
        const searchInput = document.getElementById('searchInput');
        const statusSelect = document.getElementById('statusSelect');
        const categorySelect = document.getElementById('categorySelect');
        const tableOverlay = document.getElementById('tableLoadingOverlay');
        
        // Show loading state
        tableOverlay.classList.remove('hidden');
        
        // Reset all filter fields
        if (searchInput) {
            searchInput.value = '';
        }
        if (statusSelect) {
            statusSelect.value = 'All';
        }
        if (categorySelect) {
            categorySelect.value = 'All';
        }
        
        // Hide clear button
        const clearButton = document.getElementById('clearButton');
        if (clearButton) {
            clearButton.style.display = 'none';
        }
        
        // Redirect to clean page (refresh without query parameters)
        setTimeout(() => {
            window.location.href = '@Url.Action("MyTickets", "Ticket")';
        }, 200);
    }
    
    function clearSearch() {
        const searchInput = document.getElementById('searchInput');
        const clearButton = document.getElementById('clearButton');
        const tableOverlay = document.getElementById('tableLoadingOverlay');
        
        // Show loading state
        tableOverlay.classList.remove('hidden');
        
        if (searchInput) {
            searchInput.value = '';
        }
        
        // Hide clear button immediately
        if (clearButton) {
            clearButton.style.display = 'none';
        }
        
        // Submit form after brief delay
        setTimeout(() => {
            const form = document.querySelector('form');
            if (form) {
                form.submit();
            }
        }, 200);
    }
    
    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeTicketModal();
        }
    });
</script>
</body></html>
